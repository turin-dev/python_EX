# 48장 – 배포와 환경 관리

봇을 개발하는 것만큼 중요한 것이 바로 **배포**와 **환경 관리**입니다. 이 장에서는 봇을 프로덕션 환경에 배포할 때 고려해야 할 사항과, 구성 정보를 안전하게 관리하는 방법을 살펴봅니다.

## 가상 환경과 종속성 관리

파이썬 프로젝트는 가상 환경을 만들어 독립적인 패키지 공간을 유지하는 것이 좋습니다. `python -m venv venv` 명령으로 프로젝트 루트에 가상 환경을 만들고, 활성화한 뒤 `pip install -r requirements.txt`로 필요한 패키지를 설치합니다. 종속성 목록은 `requirements.txt` 또는 `pyproject.toml`/`poetry.lock` 파일에 기록하여 동일한 환경을 재현할 수 있도록 합니다.

## 환경 변수와 설정 파일

봇 토큰과 데이터베이스 URL 같은 민감한 정보는 코드에 하드코딩하지 않고 **환경 변수**에 저장합니다. `os.environ`을 통해 불러올 수 있으며, `.env` 파일에 키-값 쌍을 작성하고 `python-dotenv` 패키지를 사용해 로드할 수 있습니다. 또한 단순한 설정 값은 INI 형식의 구성 파일로 저장할 수 있습니다. `configparser` 모듈은 INI 파일을 읽고 쓰는 기능을 제공하며, Quick Start 섹션에서는 파일을 생성하고 섹션과 옵션을 추가하는 방법을 설명합니다【257164874177851†L96-L166】.

```ini
[bot]
token = ${DISCORD_TOKEN}
prefix = !

[database]
url = sqlite:///data.db
```

위와 같은 INI 파일을 프로젝트 루트에 두고 다음과 같이 읽을 수 있습니다:

```python
import os
import configparser

config = configparser.ConfigParser()
config.read("config.ini", encoding="utf-8")

token = os.environ.get("DISCORD_TOKEN", config["bot"]["token"])
prefix = config["bot"].get("prefix", "!")
db_url = config["database"]["url"]
```

환경 변수 값이 우선되고, 없으면 파일에서 값을 가져옵니다. 이렇게 하면 코드에 비밀을 포함하지 않고도 구성 값을 중앙화할 수 있습니다.

## 배포 전략

봇을 상시 실행하려면 운영 환경에 따라 다양한 배포 방식을 선택할 수 있습니다:

* **시스템 서비스**: 리눅스 서버에서는 `systemd` 서비스로 봇을 관리할 수 있습니다. 유닛 파일에서 가상 환경 경로와 실행 명령을 지정하고, 재시작 정책을 설정합니다.
* **도커(Docker)**: 컨테이너를 사용하면 실행 환경을 이미지로 정의하여 배포의 일관성을 높일 수 있습니다. Dockerfile에서 Python 이미지를 기반으로 코드를 복사하고 `pip install -r requirements.txt`를 실행한 뒤, `CMD`로 봇을 시작합니다.
* **PaaS (Platform as a Service)**: Heroku, Fly.io 같은 플랫폼은 Git 저장소 연동과 자동 배포를 지원합니다. 환경 변수는 플랫폼 대시보드에서 설정할 수 있고, 로그를 웹에서 직접 확인할 수 있습니다.

배포 환경에서는 자동 재시작, 모니터링, 스케일링 등을 고려해야 합니다. 특히 봇이 많은 길드에 가입하게 되면 샤딩을 통해 부하를 분산시키고, 각 인스턴스를 독립적으로 배포해야 합니다. 또한 운영 환경에서 로그는 파일 대신 중앙 로그 수집 시스템으로 전송하는 것이 관리에 용이합니다.

## 요약

배포와 환경 관리는 봇의 안정적인 운영을 위해 필수적입니다. 가상 환경을 사용하여 종속성을 고립시키고, 민감한 정보는 환경 변수나 INI 파일에 저장하세요. `configparser`를 이용해 설정 파일을 읽고 쓰는 방법이 공식 문서에 자세히 설명되어 있습니다【257164874177851†L96-L166】. 서버나 도커, PaaS 등 자신의 환경에 맞는 배포 전략을 선택하고, 샤딩과 로깅을 통해 가용성과 확장성을 확보하세요.